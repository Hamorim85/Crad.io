<div class="container mailings-content">
  <div class="mailings-list">
    <% @influencers.each do |influencer| %>
      <%= render 'components/inf-card', influencer: influencer, summary: true, active: true %>
    <% end %>
  </div>
  <div class="mailings-form">

    <% sample_mail = "Dear <InfluencerName>, we are a company that produces vegan fitness nutrition under the brand HappyVeganSupplements. We are currently looking for Influencers that live a vegan lifestyle and would have an interest in a promotional cooperation. Please let us know if we could arouse youre interest, have a look at our product portfolio for further infos: www.happyvegansupplements.com. Kind regards, Your Team XYZ"%>
      <div class="sticky-mailing">
        <%= simple_form_for @mailing do |f| %>
          <%= f.input :content, label: "Write your message:", placeholder: sample_mail, as: :text, input_html: {rows: 16, class: "mail_text_field"} %>
          <%= f.input :influencers_array, as: :hidden %>
          <%= f.submit "send", class: "btn btn-primary" %>
        <% end %>
      </div>
  </div>
</div>

<% content_for(:after_js) do %>
  <script>
    const myArray = "<%= params[:influencers_ids] %>".split(',');
    document.getElementById("mailing_influencers_array").value = myArray;

    document.querySelectorAll(".inf-selector").forEach((field) => {
      field.addEventListener("click", (event) => {
        event.currentTarget.classList.toggle("active");
        if (myArray.includes(field.id)) {
          let x = myArray.findIndex(x => x == field.id);
          myArray.splice(x, 1);
        } else {
          myArray.push(field.id);
        };
        document.getElementById("mailing_influencers_array").value = myArray;
      });
    });

    // Assign myArray value to the following input:
    // document.getElementById("mailing_influencers_array")

  </script>
<% end %>
